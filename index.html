<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Tối ưu cho Android WebView -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tắt các tính năng không cần thiết để tăng performance -->
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="cleartype" content="on">

    <!-- Preconnect để load ảnh nhanh hơn -->
    <link rel="preconnect" href="." crossorigin>
    
    <!-- Google Fonts - Baloo 2 (giống Candy Crush, hỗ trợ tiếng Việt) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <title>Vietjet - Chơi là có quà</title>

    <!-- Meta tags cho PWA và SEO -->
    <meta name="description" content="Game bắt máy bay Vietjet để nhận voucher">
    <meta name="application-name" content="Vietjet Game">
    <meta name="theme-color" content="#E20074">

    <!-- Apple iOS -->
    <meta name="apple-mobile-web-app-title" content="Vietjet Game">

    <!-- Microsoft Windows -->
    <meta name="msapplication-TileColor" content="#E20074">
    <meta name="msapplication-navbutton-color" content="#E20074">

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Audio Unlock Overlay -->
    <div id="audio-unlock" class="audio-unlock-overlay">
        <div class="audio-unlock-content">
            <div class="audio-icon"><img src="assets/ui/default//btn/play.png" alt="Play"></div>
            <p>Chạm để bắt đầu</p>
        </div>
    </div>

    <!-- Màn hình chào mừng - Splash Screen -->
    <div id="welcome-screen" class="screen active splash-screen">
        <!-- Animated clouds -->
        <!-- <div class="splash-cloud cloud-1">
        <img src="assets/cloud.png" alt="Cloud">
    </div>
    <div class="splash-cloud cloud-2">
        <img src="assets/cloud_2.png" alt="Cloud">
    </div>
    <div class="splash-cloud cloud-3">
        <img src="assets/cloud.png" alt="Cloud">
    </div>
    <div class="splash-cloud cloud-4">
        <img src="assets/cloud_2.png" alt="Cloud">
    </div>
    <div class="splash-cloud cloud-5">
        <img src="assets/cloud.png" alt="Cloud">
    </div> -->


        <!-- Animated planes -->
        <!-- <div class="splash-plane plane-anim-1">
        <img src="assets/player/vj1.png" alt="Plane">
    </div>
    <div class="splash-plane plane-anim-2">
        <img src="assets/player/vj3.png" alt="Plane">
    </div>
    <div class="splash-plane plane-anim-3">
        <img src="assets/player/vj8.png" alt="Plane">
    </div> -->


        <div class="splash-container">
            <!-- <div class="splash-logo">
                <img src="assets/logo_white.png" alt="Vietjet Logo">
            </div> -->
            <h1 class="splash-title" style="margin-top: 30vh;">BẮT MÁY BAY VIETJET</h1>
            <p class="splash-subtitle">MASTER THE SKIES</p>
            <button class="splash-button">
                <span>TAP TO START</span>
            </button>
            <button class="splash-row-button">
                <img src="assets/ui/default/btn/prize.png" alt="Shop">
                <img src="assets/ui/default/btn/faq.png" alt="Shop">
            </button>
        </div>

        <!-- Main Menu Layers -->
        <div class="main-menu-layers">
            <!-- Skyline (behind building) -->
            <!-- <div class="skyline-layer">
                <img src="assets/main_menu/skyline.png" alt="Skyline">
            </div> -->

            <!-- Cloud Left -->
            <div class="cloud-left">
                <img src="assets/main_menu/cloud_left.png" alt="Cloud Left">
            </div>

            <!-- Cloud Right -->
            <div class="cloud-right">
                <img src="assets/main_menu/cloud_right.png" alt="Cloud Right">
            </div>

        </div>

        <!-- Decorative elements -->
        <!-- <div class="splash-decorations">
            <div class="circle-decoration circle-1"></div>
            <div class="circle-decoration circle-2"></div>
            <div class="circle-decoration circle-3"></div>
            <div class="circle-decoration circle-4"></div>
        </div> -->

        <!-- Music Button - Top Right -->
        <div class="corner-btn-container top-right">
            <button class="corner-btn music-btn" id="music-toggle">
                <img src="assets/ui/default/btn/music.png" alt="Music">
            </button>
        </div>

        <!-- Settings Button - Bottom Left -->
        <div class="corner-btn-container bottom-left">
            <button class="corner-btn" id="settings-toggle">
                <img src="assets/ui/default/btn/settings.png" alt="Settings">
            </button>
        </div>

        <!-- Settings Popup -->
        <div id="settings-popup" class="settings-popup">
            <div class="settings-overlay"></div>
            <div class="settings-panel">
                <!-- Close Button -->
                <button class="settings-close-btn" id="settings-close">
                    <img src="assets/ui/default/btn/close.png" alt="Close">
                </button>

                <!-- Title Bar -->
                <div class="settings-title-bar">
                  <img src="assets/ui/default/settings/92.png" alt="Settings">
                </div>

                <!-- Main Buttons -->
                <div class="settings-main-buttons">
                    <!-- Row 1: 3 nút ngang -->
                    <div class="settings-row settings-row-1">
                        <div class="settings-main-btn sound-btn">
                            <img src="assets/ui/default/btn/sound.png" alt="Sound">
                            <span>ÂM THANH</span>
                        </div>
                        <div class="settings-main-btn music-btn">
                            <img src="assets/ui/default/btn/music.png" alt="Music">
                            <span>NHẠC</span>
                        </div>
                        <div class="settings-main-btn">
                            <img src="assets/ui/default/btn/about.png" alt="Info">
                            <span>Thông tin</span>
                        </div>
                    </div>
                    
                    <!-- Row 2: 3 nút dọc -->
                    <div class="settings-row settings-row-2">
                        <button class="settings-main-btn">
                            <img src="assets/ui/default/btn/close_2.png" alt="Exit">
                            <span>THOÁT GAME</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Màn hình khảo sát - Gộp chung 2 câu hỏi -->
    <div id="survey-screen" class="screen">
        <!-- Flash message cho validation -->
        <div id="flash-message" class="flash-message">
            <span>⚠️ Vui lòng chọn câu trả lời!</span>
        </div>

        <div class="survey-card">
            <h2 class="screen-title">Khảo sát ngắn</h2>
            <p class="intro-text" id="survey-intro">Trước khi bắt đầu chơi, xin phép bạn trả lời 2 câu hỏi sau đây nhé</p>

            <!-- Câu hỏi 1 -->
            <div class="question-block" id="question-1">
                <p class="question-number">Câu 1/2</p>
                <p class="question">Đây có phải là lần đầu bạn di chuyển bằng máy bay không?</p>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q1" value="yes" required>
                        <span>Đúng</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="no">
                        <span>Không</span>
                    </label>
                </div>
            </div>

            <!-- Câu hỏi 2 -->
            <div class="question-block" id="question-2" style="display: none;">
                <p class="question-number">Câu 2/2</p>
                <p class="question">Bạn sẽ chọn dịch vụ bay của chúng tôi vì điều gì?</p>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q2" value="service" required>
                        <span>Dịch vụ tốt, giá cả phù hợp</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="experience">
                        <span>Tôi muốn trải nghiệm dịch vụ của hãng</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="other">
                        <span>Khác</span>
                    </label>
                </div>
            </div>

            <div class="question-block">
                <button class="survey-btn-continue" id="survey-continue-btn">
                    <img src="assets/ui/default/btn/next.png" alt="Continue">
                </button>
            </div>
        </div>
    </div>

    <!-- Màn hình giới thiệu game -->
    <div id="intro-screen" class="screen">
        <div class="intro-container">
            <!-- Title -->
            <h1 class="game-instructions-title">HƯỚNG DẪN</h1>

            <!-- Grid 2x3 -->
            <div class="instructions-grid" style="display: flex;">
                <!-- Row 1 -->
                <div class="instruction-item">
                    <h3 class="instruction-label">MỤC TIÊU</h3>
                    <div class="instruction-icon">
                        <img src="assets/target.png" alt="Target">
                    </div>
                    <p class="instruction-text">BẮT 6/10 MÁY BAY</p>
                </div>

                <div class="instruction-item">
                    <h3 class="instruction-label">THỜI GIAN</h3>
                    <div class="instruction-icon">
                        <img src="assets/clock.png" alt="Clock">
                    </div>
                    <p class="instruction-text">MỖI LẦN BẮT +2S</p>
                </div>

                <div class="instruction-item">
                    <h3 class="instruction-label">MẠNG</h3>
                    <div class="instruction-icon">
                        <img src="assets/heart.png" alt="Heart">
                    </div>
                    <p class="instruction-text">BẠN CÓ 3 MẠNG</p>
                </div>
            </div>

            <!-- Play Button -->
            <button class="btn-play-game-new" id="start-game-btn">
                <span>BẮT ĐẦU CHƠI</span>
            </button>
        </div>
    </div>

    <!-- Màn hình Gacha - Random Map -->
    <div id="gacha-screen" class="screen">
        <div class="gacha-container">
            <!-- Title -->
            <h1 class="gacha-title">ĐANG CHỌN BẢN ĐỒ...</h1>
            
            <!-- Gacha Machine -->
            <div class="gacha-machine">
                <!-- Slot Machine Frame -->
                <div class="gacha-frame">
                    <!-- Top Decoration -->
                    <div class="gacha-top"></div>
                    
                    <!-- Slot Window -->
                    <div class="slot-window">
                        <div class="slot-shine"></div>
                        <div class="slot-content" id="slot-content">
                            <!-- Map thumbnails will scroll here -->
                        </div>
                    </div>
                    
                    <!-- Bottom Decoration -->
                    <div class="gacha-bottom"></div>
                </div>
                
                <!-- Light Effects -->
                <div class="gacha-lights">
                    <div class="light light-1"></div>
                    <div class="light light-2"></div>
                    <div class="light light-3"></div>
                    <div class="light light-4"></div>
                </div>
            </div>
            
            <!-- Result Text -->
            <div class="gacha-result" id="gacha-result">
                <p>Đang quay...</p>
            </div>
        </div>
    </div>

    <!-- Màn hình game -->
    <div id="game-screen" class="screen">
        <!-- Countdown Overlay -->
        <div id="countdown-overlay" class="countdown-overlay">
            <div class="countdown-content">
                <div class="countdown-text">Vietjet Air sẽ cất cánh trong</div>
                <div class="countdown-number" id="countdown-number">3</div>
            </div>
        </div>

        <!-- Cut-in Animation -->
        <div id="cutin-overlay" class="cutin-overlay">
            <!-- Speed Lines Background -->
            <div class="speed-lines">
                <div class="speed-line"></div>
                <div class="speed-line"></div>
                <div class="speed-line"></div>
                <div class="speed-line"></div>
                <div class="speed-line"></div>
            </div>

            <!-- Flash Effect -->
            <div class="flash-effect"></div>

            <!-- Main Cut-in Image -->
            <div class="cutin-main">
                <img src="assets/cut_in/cut_in_animation.png" alt="Vietjet Takeoff">
            </div>

            <!-- Slash Lines -->
            <div class="slash-lines">
                <div class="slash-line slash-1"></div>
                <div class="slash-line slash-2"></div>
                <div class="slash-line slash-3"></div>
            </div>

            <!-- Particles -->
            <div class="particles">
                <div class="particle p1"></div>
                <div class="particle p2"></div>
                <div class="particle p3"></div>
                <div class="particle p4"></div>
                <div class="particle p5"></div>
                <div class="particle p6"></div>
            </div>

            <!-- Text Effect -->
            <div class="cutin-text">CẤT CÁNH!</div>
        </div>

        <div class="game-header">
            <div class="score-board">
                <div class="score-box">
                    <div class="score-icon">🛫</div>
                    <div class="score-info">
                        <span class="score-label">VietJet đã xuất hiện:</span>
                        <span class="score-value" id="vietjet-spawned">0/10</span>
                    </div>
                </div>
                <div class="score-box">
                    <div class="score-icon">✈️</div>
                    <div class="score-info">
                        <span class="score-label">Máy bay bắt được:</span>
                        <span class="score-value" id="caught-count">0/10</span>
                    </div>
                </div>
                <div class="score-box">
                    <div class="score-icon">⏱️</div>
                    <div class="score-info">
                        <span class="score-label">Thời gian còn lại:</span>
                        <span class="score-value timer" id="time-left">20s</span>
                    </div>
                </div>
                <div class="score-box">
                    <div class="score-icon">💖</div>
                    <div class="score-info">
                        <span class="score-label">Mạng còn lại:</span>
                        <span class="score-value" id="chances-left">3</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main game canvas -->
        <canvas id="game-canvas"></canvas>

        <!-- Game Over Popup -->
        <div id="game-over-popup" class="game-over-popup">
            <div class="game-over-content">
                <div class="game-over-icon">💔</div>
                <h2 class="game-over-text">BẠN ĐÃ THUA!</h2>
                <p class="game-over-score">Số máy bay bắt được: <span id="popup-score">0</span>/10</p>
                <p class="game-over-hint">(Chạm để tiếp tục)</p>
            </div>
        </div>
    </div>

    <!-- Màn hình thắng -->
    <div id="win-screen" class="screen">
        <div class="victory-container">
            <!-- Tech Border Frame -->
            <div class="tech-border">
                <!-- Corner Decorations -->
                <div class="corner-decoration top-left"></div>
                <div class="corner-decoration top-right"></div>
                <div class="corner-decoration bottom-left"></div>
                <div class="corner-decoration bottom-right"></div>

                <!-- Side Indicators -->
                <div class="side-indicators left">
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                </div>
                <div class="side-indicators right">
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                    <div class="indicator"></div>
                </div>
            </div>

            <!-- Victory Content -->
            <div class="victory-content">
                <!-- Left Side: Image + Text -->
                <div class="victory-left">
                    <div class="victory-image">
                        <img src="assets/win_2.png" alt="Victory Plane">
                        <div class="explosion-effect"></div>
                    </div>
                    <div class="victory-text-box">
                        <h1 class="victory-title">CHIẾN THẮNG!</h1>
                        <p class="victory-subtitle">NHIỆM VỤ HOÀN THÀNH. TẤT CẢ MÁY BAY ĐÃ BẮT ĐƯỢC.</p>
                    </div>
                </div>

                <!-- Right Side: QR Code -->
                <div class="victory-right">
                    <div class="qr-code-container">
                        <img id="qr-image" src="assets/qr_code_level_1.png" alt="QR Vietjet">
                    </div>
                    <div class="qr-link-text">
                        <a href="https://www.vietjetair.com/rewards" target="_blank">www.vietjetair.com/rewards</a>
                    </div>
                    
                    <!-- Continue Button -->
                    <button class="btn-victory-continue" id="win-continue-btn">
                        <span>TIẾP TỤC</span>
                    </button>
                </div>
            </div>


        </div>
    </div>

    <!-- Màn hình thua -->
    <div id="lose-screen" class="screen">
        <div class="container">
            <div class="result-icon lose">
                <img src="assets/loser.png" alt="Lose" style="max-width: 120px; height: auto;">
            </div>
            <h2 class="screen-title">Bạn suýt bắt được máy bay rồi</h2>
            <p class="result-text">Hãy thử lại vào lần sau nhé!</p>
            <p class="intro-text">Không sao, Vietjet vẫn luôn đồng hành cùng bạn trong mọi hành trình!</p>
            <button class="btn btn-primary" id="lose-continue-btn">
                Tiếp tục
            </button>
        </div>
    </div>

    <!-- Màn hình đánh giá -->
    <div id="rating-screen" class="screen">
        <div class="container">
            <h2 class="screen-title">Đánh giá dịch vụ</h2>
            <p class="intro-text">Bạn có hài lòng với dịch vụ hôm nay không?</p>
            <div id="rating-emoji" class="rating-emoji">🤔</div>
            <div class="star-rating">
                <span class="star" data-value="1">☆</span>
                <span class="star" data-value="2">☆</span>
                <span class="star" data-value="3">☆</span>
                <span class="star" data-value="4">☆</span>
                <span class="star" data-value="5">☆</span>
            </div>
            <p id="rating-value" class="rating-value"></p>
        </div>
    </div>

    <!-- Màn hình cảm ơn -->
    <div id="thank-screen" class="screen">
        <div class="container">
            <div class="logo">
                <img src="assets/logo_white.png" alt="Vietjet Logo" width="200">
            </div>

            <h2 class="screen-title">Cảm ơn bạn!</h2>
            <p class="intro-text">Xin cảm ơn bạn đã sử dụng dịch vụ của Vietjet ngày hôm nay. Chúc bạn có 1 chuyến đi
                vui vẻ và an toàn nhé.</p>

            <button class="btn btn-primary" id="restart-btn">
                Chơi lại
            </button>
        </div>
    </div>

    <!-- Modal điều kiện thắng thua -->
    <div id="rules-modal" class="modal">
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close" id="modal-close-btn">×</button>
            <h3 class="modal-title"><span style="filter: none; -webkit-text-fill-color: initial;">📋</span> <span>Điều
                    kiện thắng - thua</span></h3>

            <div class="rules-section">
                <h4 class="rules-heading">🏆 ĐIỀU KIỆN THẮNG:</h4>
                <ul class="rules-list">
                    <li>✅ Bắt được <strong>6/10 máy bay VietJet</strong></li>
                    <li>⏰ Hoàn thành trong <strong>thời gian cho phép</strong></li>
                    <li>💖 Còn ít nhất <strong>1 mạng</strong></li>
                </ul>
            </div>

            <div class="rules-section">
                <h4 class="rules-heading">💔 ĐIỀU KIỆN THUA:</h4>
                <ul class="rules-list">
                    <li>❌ Hết <strong>3 cơ hội</strong> (chạm nhầm 3 lần)</li>
                    <li>⏱️ Hết <strong>thời gian</strong> (0 giây)</li>
                    <li>🎯 Bạn sẽ thua nếu chưa đủ <strong>6/10 máy bay</strong> lúc hết thời gian hoặc khi <strong>10
                            chiếc đã qua</strong></li>
                </ul>
            </div>

            <div class="rules-section tips">
                <h4 class="rules-heading">💡 MẸO CHƠI:</h4>
                <ul class="rules-list">
                    <li>🎯 Chỉ chạm vào <strong>máy bay VietJet</strong> (có logo VietJet)</li>
                    <li>⚠️ Tránh chạm vào máy bay khác (bị trừ mạng)</li>
                    <li>⚡ Bắt máy bay nhanh để cộng thêm thời gian</li>
                </ul>
            </div>

            <div style="display: flex; justify-content: center;">
                <button class="btn btn-primary" id="modal-ok-btn">
                    Đã hiểu
                </button>
            </div>
        </div>
    </div>

    <script src="apiHelper.js"></script>
    <script src="gameConfig.js"></script>
    <script src="game.js"></script>
</body>

</html>